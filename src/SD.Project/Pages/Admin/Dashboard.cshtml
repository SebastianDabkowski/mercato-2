@page
@model SD.Project.Pages.Admin.DashboardModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<h1>Marketplace Performance Dashboard</h1>
<p>Welcome to the administration panel, @User.Identity?.Name!</p>

<!-- Date Range Filter -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label for="dateRange" class="form-label">Date Range</label>
                <select id="dateRange" name="dateRange" class="form-select" onchange="toggleCustomDateInputs()">
                    @foreach (var preset in Model.DateRangePresets)
                    {
                        if (preset.IsSelected)
                        {
                            <option value="@preset.Value" selected>@preset.Name</option>
                        }
                        else
                        {
                            <option value="@preset.Value">@preset.Name</option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-3 custom-date-input" style="display: @(Model.DateRange == "custom" ? "block" : "none")">
                <label for="customFromDate" class="form-label">From</label>
                <input type="date" id="customFromDate" name="customFromDate" class="form-control" 
                       value="@(Model.CustomFromDate?.ToString("yyyy-MM-dd") ?? Model.Metrics.FromDate.ToString("yyyy-MM-dd"))" />
            </div>
            <div class="col-md-3 custom-date-input" style="display: @(Model.DateRange == "custom" ? "block" : "none")">
                <label for="customToDate" class="form-label">To</label>
                <input type="date" id="customToDate" name="customToDate" class="form-control" 
                       value="@(Model.CustomToDate?.ToString("yyyy-MM-dd") ?? Model.Metrics.ToDate.ToString("yyyy-MM-dd"))" />
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary">Apply</button>
                <a href="@Url.Page("/Admin/Dashboard")" class="btn btn-outline-secondary ms-2">Reset</a>
            </div>
        </form>
    </div>
</div>

<!-- Refresh Indicator -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <span class="badge bg-info fs-6">@Model.Metrics.PeriodLabel</span>
    <span class="text-muted small">
        <i class="bi bi-clock"></i> @Model.Metrics.RefreshTimeDisplay
        <button onclick="location.reload()" class="btn btn-link btn-sm p-0 ms-2" title="Refresh dashboard">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
    </span>
</div>

<!-- No Data Message -->
@if (!Model.Metrics.HasData)
{
    <div class="alert alert-info" role="alert">
        <i class="bi bi-info-circle"></i> No data available for the selected period. 
        All KPIs will show zero values. Try selecting a different date range or wait for new activity.
    </div>
}

<!-- KPI Tiles -->
<div class="row mb-4">
    <!-- GMV Tile -->
    <div class="col-md-4 col-lg mb-3">
        <div class="card h-100 border-primary">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Gross Merchandise Value</h6>
                <h2 class="card-title text-primary mb-3">@Model.Metrics.FormattedGmv</h2>
                <p class="card-text small text-muted">Total order value including shipping</p>
            </div>
            <a href="@Url.Page("/Admin/Settlements", new { dateRange = Model.DateRange, customFromDate = Model.CustomFromDate?.ToString("yyyy-MM-dd"), customToDate = Model.CustomToDate?.ToString("yyyy-MM-dd") })" 
               class="card-footer text-center text-decoration-none">
                View Settlement Details →
            </a>
        </div>
    </div>

    <!-- Orders Tile -->
    <div class="col-md-4 col-lg mb-3">
        <div class="card h-100 border-success">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Total Orders</h6>
                <h2 class="card-title text-success mb-3">@Model.Metrics.OrderCount.ToString("N0")</h2>
                <p class="card-text small text-muted">Orders placed in period</p>
            </div>
            <a href="@Url.Page("/Admin/OrderDetails", new { dateRange = Model.DateRange })" 
               class="card-footer text-center text-decoration-none">
                View Order Details →
            </a>
        </div>
    </div>

    <!-- Active Sellers Tile -->
    <div class="col-md-4 col-lg mb-3">
        <div class="card h-100 border-warning">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Active Sellers</h6>
                <h2 class="card-title text-warning mb-3">@Model.Metrics.ActiveSellerCount.ToString("N0")</h2>
                <p class="card-text small text-muted">With products or orders</p>
            </div>
            <a href="#" class="card-footer text-center text-decoration-none">
                View Seller Details →
            </a>
        </div>
    </div>

    <!-- Active Products Tile -->
    <div class="col-md-6 col-lg mb-3">
        <div class="card h-100 border-info">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">Active Products</h6>
                <h2 class="card-title text-info mb-3">@Model.Metrics.ActiveProductCount.ToString("N0")</h2>
                <p class="card-text small text-muted">Products with 'Active' status</p>
            </div>
            <a href="@Url.Page("/Admin/Categories")" class="card-footer text-center text-decoration-none">
                View Product Categories →
            </a>
        </div>
    </div>

    <!-- New Users Tile -->
    <div class="col-md-6 col-lg mb-3">
        <div class="card h-100 border-secondary">
            <div class="card-body text-center">
                <h6 class="card-subtitle mb-2 text-muted">New Users</h6>
                <h2 class="card-title text-secondary mb-3">@Model.Metrics.NewUserCount.ToString("N0")</h2>
                <p class="card-text small text-muted">Registered in period</p>
            </div>
            <a href="#" class="card-footer text-center text-decoration-none">
                View User Details →
            </a>
        </div>
    </div>
</div>

<!-- Quick Links (existing navigation) -->
<h4 class="mt-4">Quick Links</h4>
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Category Management</h5>
                <p class="card-text">Manage the product category tree.</p>
                <a asp-page="/Admin/Categories" class="btn btn-primary">Manage Categories</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Monthly Settlements</h5>
                <p class="card-text">Generate and manage seller settlements.</p>
                <a asp-page="/Admin/Settlements" class="btn btn-primary">View Settlements</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Review Moderation</h5>
                <p class="card-text">Moderate product reviews and ratings.</p>
                <a asp-page="/Admin/ReviewModeration" class="btn btn-primary">Moderate Reviews</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Returns & Disputes</h5>
                <p class="card-text">Handle return requests and disputes.</p>
                <a asp-page="/Admin/ReturnsDisputes" class="btn btn-primary">View Returns</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">User Management</h5>
                <p class="card-text">Manage platform users and roles.</p>
                <a href="#" class="btn btn-primary">Manage Users</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Platform Settings</h5>
                <p class="card-text">Configure platform-wide settings.</p>
                <a href="#" class="btn btn-primary">Settings</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleCustomDateInputs() {
            var dateRange = document.getElementById('dateRange').value;
            var customInputs = document.querySelectorAll('.custom-date-input');
            customInputs.forEach(function(input) {
                input.style.display = dateRange === 'custom' ? 'block' : 'none';
            });
        }
    </script>
}
